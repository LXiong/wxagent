## 微信消息中的多媒体内容处理

多媒体内容，包括emoji表情，动画表情，图片，文件，语音信息。

有两种中继传输的方式
* 第一种，使用直接传输多媒体内容的方法，但这需要中继协议与客户端的良好的支持。
* 第二种，使用第三方存储平台，把存储的URL以消息的形式传递给客户端。

第一种方式比较直观，用户体验比较好，对中继协议与客户端要求比较高，而且中继程序也会复杂一些。
第二种方式，使用体验不好，需要浏览器打开URL才能看到内容，
文本消息与多媒体消息分开了，操作上也不方便。
但这种方式非常通用，所有的中继协议都支持文字传输。


### emoji表示的处理

目前的测试情况，有些客户端发过来，是标准的emoji，有些不是标准的，而是中文的。
也就是weixin的emoji并不太统一，需要测试出有什么区分，分别处理。
可暂不处理，直接转发。

### 动画表情
有时存储于cdn中，但如果cdnurl值为空，则需要通过wxagent获取动态图片内容，返回客户端。
这一步需要通过wxagent直接拿到图片内容，因为获取的过期需要http cookie。
对于cdnurl值不为空的情况，直接转发url地址，让客户端处理如何显示动态表情图片。

### 图片
存储在wx的私有图片服务器，需要通过wxagent获取动态图片内容，返回客户端。
这一步需要通过wxagent直接拿到图片内容，因为获取的过期需要http cookie。
客户端获得返回的图片内容数据，再处理如何显示图片。

### 文件
有时存储在cdn中，可跳过wxagent客户端直接获取该cdnurl，下载对应文件。
有时cdnurl值为空，则需要通过wxagent获取文件内容，返回客户端。
这里如果文件比较大的话，比较难处理，或许可以借助第三方存储，但又缺少点安全性。

### 语音信息
需要通过wxagent获取语言信息的内容，返回客户端。
wxagent客户端获取到返回的语言信息内容，决定如何播放语音信息。



